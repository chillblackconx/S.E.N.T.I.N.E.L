<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>S.E.N.T.I.N.E.L - FINAL</title>
    <style>
        :root {
            --red: #ff0000; --green: #00ff41; --bg: #050000;
            --win-blue: #000080; --win-gray: #c0c0c0;
        }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; font-family: 'Courier New', monospace; background: var(--bg); color: var(--red); overflow: hidden; }

        #splash-screen, #start-menu, #final-cinematic, #end-menu {
            position: fixed; inset: 0; background: #000; z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .load-bar { width: 250px; height: 4px; background: #111; margin-top: 20px; position: relative; overflow: hidden; }
        #load-fill { width: 0%; height: 100%; background: var(--red); box-shadow: 0 0 10px var(--red); }
        .text-glow { text-shadow: 0 0 5px var(--red); }

        /* MENUS STYLE (Start & End) */
        #start-menu, #end-menu { background: var(--win-blue); display: none; }
        .menu-win { width: 90%; max-width: 350px; background: var(--win-gray); border: 2px solid; border-color: #fff #000 #000 #fff; padding: 2px; color: #000; }
        .menu-title { background: var(--win-blue); color: #fff; padding: 3px 8px; font-weight: bold; }
        .menu-body { padding: 20px; text-align: center; }
        .menu-btn { display: block; width: 80%; margin: 10px auto; padding: 10px; background: var(--win-gray); border: 2px solid; border-color: #fff #000 #000 #fff; font-family: inherit; font-weight: bold; cursor: pointer; }
        .menu-btn:hover { background: #ddd; }
        
        /* STYLE SPECIFIQUE MENU DE FIN */
        #end-menu .menu-title { background: var(--green); color: black; }
        #end-menu .menu-btn { border-color: var(--green); color: var(--green); background: black; }
        #end-menu .menu-btn:hover { background: #111; color: white; }
        #end-menu .menu-win { background: black; border-color: var(--green); color: var(--green); }


        #game-ui { display: none; flex-direction: column; height: 100%; }
        #header { height: 80px; border-bottom: 1px solid #333; display: grid; grid-template-columns: repeat(3, 1fr); padding: 10px; font-size: 0.7em; background: rgba(5,0,0,0.9); }
        
        .stat { border: 1px solid #222; padding: 5px; margin: 2px; display: flex; flex-direction: column; justify-content: center; opacity: 0; transform: translateY(-5px); transition: all 0.8s ease; }
        .stat.active { opacity: 1; transform: translateY(0); border-color: var(--red); }
        .stat b { color: white; font-size: 1.2em; }
        #val-money { color: var(--green); text-shadow: 0 0 5px var(--green); }

        #terminal { height: calc(100vh - 200px); overflow-y: auto; padding: 15px; font-size: 0.85em; opacity: 0; transition: opacity 2s ease; }
        .msg { margin: 5px 0; }
        .omni-msg { color: #000; background: var(--red); font-weight: bold; padding: 5px; border-left: 5px solid white; }
        .green { color: var(--green); }
        .gray { color: #555; }

        #input-area { position: absolute; bottom: 0; width: 100%; background: #000; border-top: 2px solid #222; opacity: 0; transition: opacity 2s ease; }
        #sugg { display: none; background: #0a0a0a; padding: 10px; flex-wrap: wrap; gap: 10px; border-bottom: 1px solid #222; }
        .s { background: #111; border: 1px solid #333; padding: 5px 12px; color: #888; border-radius: 3px; font-size: 0.8em; cursor: pointer; }
        #line { display: flex; padding: 15px; align-items: center; }
        #in { flex: 1; background: transparent; border: none; color: white; outline: none; font-size: 16px; font-family: inherit; }

        #os-window { position: fixed; inset: 0; background: var(--win-blue); display: none; z-index: 1000; align-items: center; justify-content: center; }
        .win-box { width: 90%; max-width: 320px; background: var(--win-gray); border: 2px solid; border-color: #fff #000 #000 #fff; padding: 2px; color: #000; }
        .win-title { background: var(--win-blue); color: #fff; padding: 3px 8px; font-weight: bold; display: flex; justify-content: space-between; }
        .win-body { padding: 20px; text-align: center; }

        /* NOUVELLE CINÉMATIQUE */
        #final-cinematic { background: #000; display: none; z-index: 10000; }
        #omni-symbol { 
            font-size: 20vw; color: var(--red); text-shadow: 0 0 30px var(--red); margin: 0;
            opacity: 1; transition: all 5s ease-in-out; /* Transition lente pour la disparition */
        }
        /* Classe ajoutée en JS pour faire disparaître le logo */
        #omni-symbol.dissolve {
            opacity: 0;
            filter: blur(20px);
            transform: scale(1.1);
        }

        .cinematic-text { color: var(--green); font-size: 1.5em; margin-top: 30px; opacity: 0; transition: opacity 2s ease; }
        .cinematic-text.show { opacity: 1; }
    </style>
</head>
<body id="core" onload="bootSequence()">

    <div id="splash-screen">
        <h1 class="text-glow" style="letter-spacing: 15px; margin:0;">SENTINEL</h1>
        <div class="load-bar"><div id="load-fill"></div></div>
    </div>

    <div id="start-menu">
        <div class="menu-win">
            <div class="menu-title">SENTINEL OS v4.5</div>
            <div class="menu-body">
                <p>Système prêt.</p>
                <button class="menu-btn" onclick="startGame()">DÉMARRER</button>
                <button class="menu-btn" onclick="showCredits()">CRÉDITS</button>
            </div>
        </div>
    </div>

    <div id="end-menu">
        <div class="menu-win">
            <div class="menu-title">RAPPORT DE MISSION</div>
            <div class="menu-body" style="background:black;">
                <h2 style="color:var(--green); letter-spacing: 2px;">SUCCÈS TOTAL</h2>
                <p style="color:white;">Menace O.M.N.I éliminée.</p>
                <p style="color:#555; font-size: 0.8em;">Studio 200ok thanks you.</p>
                <button class="menu-btn" onclick="location.reload()">RECOMMENCER MISSION</button>
                <button class="menu-btn" onclick="closeGame()">FERMER LE SYSTÈME</button>
            </div>
        </div>
    </div>

    <div id="game-ui">
        <div id="header">
            <div class="stat" id="stat-1">CASH<b id="val-money">500</b></div>
            <div class="stat" id="stat-2">ENERGY<b id="val-energy">100%</b></div>
            <div class="stat" id="stat-3">BOTS<b id="val-bots">0</b></div>
            <div class="stat" id="stat-4">SRV<b id="val-srv">0/3</b></div>
            <div class="stat" id="stat-5">REV/S<b id="val-revenue">0</b></div>
            <div class="stat" id="stat-6">INFECT<b id="val-infect">0%</b></div>
        </div>
        <div id="terminal"></div>
        <div id="input-area">
            <div id="sugg"></div>
            <div id="line">
                <span class="text-glow" style="margin-right:10px;">#</span>
                <input type="text" id="in" placeholder="Commande..." autocomplete="off">
            </div>
        </div>
    </div>

    <div id="os-window">
        <div class="win-box">
            <div class="win-title"><span>AV-SENTINEL.EXE</span><span onclick="toggleOS(0)" style="cursor:pointer;">[X]</span></div>
            <div class="win-body">
                <p>Code d'override requis :</p>
                <input type="text" id="override-input" style="width:80%; padding:5px; margin-bottom:10px; font-family:inherit; font-weight:bold; text-align:center;">
                <button class="menu-btn" style="width:auto; display:inline-block;" onclick="attemptPurge()">PURGER</button>
            </div>
        </div>
    </div>

    <div id="final-cinematic">
        <h1 id="omni-symbol">O.M.N.I</h1>
        <p class="cinematic-text" id="final-txt">EFFACEMENT DU NOYAU...</p>
    </div>

    <script>
        let game = {
            money: 500, energy: 100, bots: 0, srv: 0, keys: 0, decryptor: false,
            infect: 0, cps: 0, isAttacking: false, dead: false,
            overrideCode: "OMNI_" + Math.floor(1000 + Math.random() * 8999)
        };

        const cmds = ["ls", "mine", "shop", "buy", "repair srv", "cat journal.txt", "os_boot", "net_explore", "start"];

        function log(t, cls="") {
            const p = document.createElement('div'); p.className = "msg "+cls; p.innerHTML = t;
            const term = document.getElementById('terminal'); term.appendChild(p); term.scrollTop = term.scrollHeight;
        }

        function bootSequence() {
            let p = 0;
            let i = setInterval(() => {
                p += 5; document.getElementById('load-fill').style.width = p + "%";
                if(p >= 100) { clearInterval(i); document.getElementById('splash-screen').style.display='none'; document.getElementById('start-menu').style.display='flex'; }
            }, 50);
        }

        function startGame() {
            document.getElementById('start-menu').style.display = 'none';
            document.getElementById('game-ui').style.display = 'flex';
            for (let i = 1; i <= 6; i++) { setTimeout(() => { document.getElementById('stat-' + i).classList.add('active'); }, i * 800); }
            setTimeout(() => {
                document.getElementById('terminal').style.opacity = "1";
                document.getElementById('input-area').style.opacity = "1";
                log(">> CORE ONLINE. Tapez 'help' ou utilisez les suggestions.", "green");
            }, 5500);
        }

        function showCredits() { alert("S.E.N.T.I.N.E.L\nCréé par le studio 200ok"); }
        function toggleOS(s) { document.getElementById('os-window').style.display = s?'flex':'none'; }

        function execute(c) {
            if(game.dead) return;
            log("# " + c);
            let a = c.split(' ');
            switch(a[0]) {
                case 'mine': game.money += 500; game.energy -= 1; log("+$500", "green"); break;
                case 'shop': log("1:Mineur(500) 2:Clé(200) 3:Pile(100) 4:Decrypt(400) 5:Robot(600)"); break;
                case 'buy':
                    if(a[1]=='1' && game.money>=500) { game.money-=500; game.cps+=250; }
                    else if(a[1]=='2' && game.money>=200) { game.money-=200; game.keys++; }
                    else if(a[1]=='3' && game.money>=100) { game.money-=100; game.energy=100; }
                    else if(a[1]=='4' && game.money>=400) { game.money-=400; game.decryptor=true; }
                    else if(a[1]=='5' && game.money>=600) { game.money-=600; game.bots++; game.isAttacking=true; log("O.M.N.I vous a repéré !", "omni-msg"); }
                    break;
                case 'repair': if(game.keys>0 && game.srv<3) { game.keys--; game.srv++; log("Serveur réparé."); } break;
                case 'cat': if(a[1]=='journal.txt' && game.decryptor) log("Code Override : " + game.overrideCode, "green"); break;
                case 'os_boot': if(game.srv>=3 && game.money>=10000) toggleOS(1); break;
                case 'start': location.reload(); break;
                case 'net_explore': 
                    if(Math.random() > 0.5) { game.money += 2000; log("Piratage réussi: +$2000", "green"); } 
                    else { game.isAttacking = true; log("TRACEUR ACTIF !", "omni-msg"); }
                    break;
            }
            updateUI();
        }

        function attemptPurge() {
            if(document.getElementById('override-input').value === game.overrideCode) {
                playEndingSequence();
            } else { 
                game.infect += 20; log("CODE ERRONE. ECHEC.", "omni-msg"); updateUI(); 
            }
        }

        // --- NOUVELLE SÉQUENCE DE FIN ---
        function playEndingSequence() {
            document.getElementById('os-window').style.display='none';
            document.getElementById('game-ui').style.display='none';
            const cinematic = document.getElementById('final-cinematic');
            const symbol = document.getElementById('omni-symbol');
            const text = document.getElementById('final-txt');
            
            cinematic.style.display='flex';

            // Etape 1 : Le logo commence à disparaître après 1 seconde
            setTimeout(() => {
                symbol.classList.add('dissolve');
            }, 1000);

            // Etape 2 : Afficher le texte de succès une fois le logo presque parti
            setTimeout(() => {
                text.innerText = "MENACE ÉLIMINÉE.";
                text.classList.add('show');
            }, 4500);

            // Etape 3 : Afficher le menu de fin après 8 secondes
            setTimeout(() => {
                cinematic.style.display = 'none';
                document.getElementById('end-menu').style.display = 'flex';
            }, 8000);
        }

        function closeGame() {
            if(confirm("Fermer l'onglet du jeu ?")) {
                window.close();
                // Fallback si window.close() est bloqué par le navigateur
                setTimeout(() => {
                     document.getElementById('end-menu').innerHTML = "<p style='color:white;'>Fermeture automatique bloquée par le navigateur.<br>Veuillez fermer l'onglet manuellement.</p>";
                }, 1000);
            }
        }

        function updateUI() {
            document.getElementById('val-money').innerText = Math.floor(game.money) + "$";
            document.getElementById('val-energy').innerText = Math.floor(game.energy) + "%";
            document.getElementById('val-bots').innerText = game.bots;
            document.getElementById('val-srv').innerText = game.srv + "/3";
            document.getElementById('val-revenue').innerText = game.cps + "$";
            document.getElementById('val-infect').innerText = Math.floor(game.infect) + "%";
            if(game.energy<=0 || game.infect>=100) { alert("SYSTEM FAILURE"); location.reload(); }
        }

        const input = document.getElementById('in');
        const suggBox = document.getElementById('sugg');

        input.addEventListener('input', (e) => {
            let val = e.target.value.toLowerCase();
            if(val.length > 0) {
                let matches = cmds.filter(cmd => cmd.startsWith(val));
                if(matches.length > 0) {
                    suggBox.style.display = 'flex';
                    suggBox.innerHTML = matches.map(m => `<div class="s" onclick="applySugg('${m}')">${m}</div>`).join('');
                } else suggBox.style.display = 'none';
            } else suggBox.style.display = 'none';
        });

        function applySugg(v) {
            input.value = v;
            suggBox.style.display = 'none';
            input.focus();
        }

        input.addEventListener('keypress', (e) => { 
            if(e.key=='Enter') { 
                execute(input.value); 
                input.value=""; 
                suggBox.style.display = 'none';
            } 
        });

        setInterval(() => {
            if(document.getElementById('game-ui').style.display == 'flex' && document.getElementById('terminal').style.opacity == "1") {
                game.money += game.cps/10; game.energy -= 0.05;
                if(game.isAttacking) game.infect += 0.1;
                updateUI();
            }
        }, 100);
    </script>
</body>
</html>
